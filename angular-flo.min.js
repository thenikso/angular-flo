!function(a,b,c,d){"use strict";var e="all",f="out",g=a.module("ngFlo",[]);g.provider("$component",["$injector",function(b){function c(){var c=this;this.register=function(c,e,g,i){if(a.isObject(c)){var j;for(var k in c)j=a.copy(c[k]),j.ins=h(j.ins),j.outs=h(j.outs,j.ins),n[k]=j;return this}if(!a.isString(c))throw"$componentProvider: Invalid component name: "+c;if(a.isFunction(e)&&(i=e,e=d,a.isDefined(i.$ins)||(i.$ins=b.annotate(i))),!a.isFunction(i))throw"$componentProvider: Invalid transformer: "+i;return a.isDefined(e)||(e=i.$ins),a.isDefined(g)||(g=i.$outs),a.isDefined(g)||(g=[f]),e=h(e),g=h(g,e),n[c]={ins:e,outs:g,transformer:i},this},this.$get=["$injector",function(b){var d=function(c,d){var e=null;if(a.isString(c)?e=n[c]:a.isFunction(c)&&(e={},e.transformer=c,e.ins=h(b.annotate(c)),e.outs=h(d),d=null),!a.isObject(e))throw"$component: No component '"+c+"' found.";var f=e.transformer;if(a.isFunction(e.compile)&&(f=b.invoke(e.compile,e,d)),!a.isFunction(f))throw"$component: Invalid transformer: "+f;var m=function(b,d){function e(){var a=k(h,arguments),b=f.apply(e,a);return l(m.outs,b,d.portsAlias)}d=d?a.copy(d):{};var h=j(a.copy(m.ins),d.portsAlias),n=j(a.copy(m.outs),d.portsAlias,h);if(e.componentName=c,e.baseComponent=m,e.ins=h,e.outs=n,e.getInNamed=g(h),e.getOutNamed=g(n),!b)return e;(b.$components=b.$components||[]).push(e),b.$on("$destroy",function(){b.$components.splice(b.$components.indexOf(e),1)});var o=i(h);if(!o)return e;var p=function(){return b.$watchCollection(o,function(c){var d=e.apply(b,c);a.extend(b,d)})};if(1==d.noInhibition||0==n.length)return p(),e;var q;return b.$watchCollection("$$watchers",function(b){for(var c,d=!0,f=b.length-1;f>=0;f--)if(c=b[f].exp,a.isString(c)&&e.getOutNamed(c)){d=!1;break}d?a.isFunction(q)&&(q(),q=null):q||(q=p())}),e};return m.componentName=c,m.ins=a.copy(e.ins),m.getInNamed=g(m.ins),m.outs=a.copy(e.outs),m.getOutNamed=g(m.outs),m};return d.register=c.register,d.names=function(){return Object.keys(n)},d}]}function g(a){return function(b){if(a)for(var c=a.length-1;c>=0;c--)if(a[c].name===b)return a[c]}}function h(b,c){if(!b)return[];if(!a.isArray(b))throw"$componentProvider: Invalid ports: "+b;var d=[];return a.forEach(b,function(b){if(a.isString(b))b={name:b,validate:e};else{if(!a.isString(b.name))throw"$componentProvider: Invalid port name: "+b.name;a.isDefined(b.validate)||(b.validate=e)}if(null!=b.name.match(/[\s\.]/))throw"$componentProvider: Port name must not contain spaces; got: "+b.name;var f=b.name.toLowerCase();a.forEach(d,function(a){if(a.name.toLowerCase()==f)throw"$componentProvider: Duplicated port name: "+b.name}),a.isArray(c)&&a.forEach(c,function(a){if(a.name.toLowerCase()==f)throw"$componentProvider: Duplicated port name: "+b.name}),d.push(b)}),d}function i(b){var c=null;if(a.isArray(b)){c="]";for(var d,e=b.length-1;e>=0;e--)d=b[e],a.isObject(d)&&(d=d.name),c=","+d+c;c.length>1?(c=c.substr(1),c="["+c):c=null}return c}function j(b,c,d){if(!c)return b;var e;return a.forEach(b,function(a){e=c[a.name],e&&(a.name=e)}),h(b,d)}function k(b,c){return a.forEach(b,function(a,b){m(a,c[b])}),c}function l(b,c,d){if(!a.isObject(c)){var e=f,g={};a.isArray(b)&&b.length>0&&(e=b[0].name),g[e]=c,c=g}var h={};if(a.forEach(b,function(a){m(a,c[a.name]),h[a.name]=c[a.name]}),!d)return h;var i,j={};return a.forEach(h,function(a,b){i=d[b],i?j[i]=a:j[b]=a}),j}function m(b,c){if(a.isDefined(c)&&(a.isFunction(b.validate)&&!b.validate(c)||c&&a.isString(b.validate)&&b.validate!=e&&typeof c!=b.validate))throw"$component: Invalid value for port '"+b.name+"'"+(a.isString(b.validate)?" expected "+b.validate:"")}var n={};return new c}]),g.provider("$network",function(){function b(b,c,d,e){this.$scope=b.$new(!0),this.$component=c,a.isDefined(d)&&(this.$scope.$network=d),this.$scope.$processes={},this.$scope.$connections={},a.isObject(e)?this.graph(e):a.isString(e)}function c(b){var c;if(!a.isString(b)||b.length<1||"."==b[0]||(c=b.lastIndexOf("."))<1)throw"$network: Invalid process path: "+b;return{process:b.substr(0,c).replace(/^[\s"'\[]+|[\s"'\]]+$/g,""),port:b.substr(c+1)}}b.prototype.process=function(b,c,d){var e=this;if((a.isString(c)||a.isFunction(c))&&(c=this.$component(c)),!a.isFunction(c))throw"$network: Invalid component: "+c;var f=this.$scope.$processes[b];a.isDefined(f)&&f.$destroy();var g=this.$scope.$new(!0);return this.$scope.$processes[b]=g,g.$on("$destroy",function(){delete e.$scope.$processes[b]}),c(g,d),this},b.prototype.connection=function(b,d){var e=this,f=c(d),g=this.$scope.$processes[f.process];if(d=f.process+"."+f.port,a.isDefined(this.$scope.$connections[d]))throw"$network: A connection to `"+d+"` is already present";var h=this.probe(b,function(a){g[f.port]=a}),i={from:b,$destroy:function(){delete e.$scope.$connections[d],h()}};return this.$scope.$connections[d]=i,this},b.prototype.data=function(b,d){var e=this,f=c(d);if(d=f.process+"."+f.port,a.isDefined(this.$scope.$connections[d]))throw"$network: A connection to `"+d+"` is already present";this.$scope.$processes[f.process][f.port]=b;var g={data:b,$destroy:function(){delete e.$scope.$connections[d]}};return this.$scope.$connections[d]=g,this},b.prototype.probe=function(b,d){b=c(b);var e=this.$scope.$processes[b.process];if(!a.isDefined(e))throw"$network: Invalid process to probe: "+b.process;if(!a.isDefined(e.$components[0].getInNamed(b.port))&&!a.isDefined(e.$components[0].getOutNamed(b.port)))throw"$network: Invalid port to probe `"+b.port+"` for process `"+b.process+"`";return e.$watch(b.port,d)},b.prototype.import=function(b,d){if(!d||a.equals({},d))return this;if(a.isObject(d)){var e="{";if(a.forEach(d,function(a,b){e+="'"+b+"':"+a+","}),1==e.length)return this;d=e.substr(0,e.length-1)+"}"}var f=this,g=b.$watchCollection(d,function(b){return a.isObject(b)?(a.forEach(b,function(b,d){if(d=c(d),a.isDefined(f.$scope.$connections[d.process+"."+d.port]))throw"$network: Importing in an already connected input port: "+d;var e=f.$scope.$processes[d.process];e&&(e[d.port]=b)}),void 0):g()});return this},b.prototype.export=function(b,d){if(!d||a.equals({},d))return this;a.isObject(d)||(d=b.$eval(d));var e=this;return a.forEach(d,function(a,d){a=c(a);var f=e.$scope.$processes[a.process];f&&f.$components[0].getOutNamed(a.port)&&f.$watch(a.port,function(a){b[d]=a})}),this},b.prototype.empty=function(){for(var a in this.$scope.$connections)this.$scope.$connections[a].$destroy();for(var b in this.$scope.$processes)this.$scope.$processes[b].$destroy();return this},b.prototype.graph=function(b){if(0==arguments.length)return b={},a.forEach(this.$scope.$processes,function(a,c){b.processes=b.processes||{},b.processes[c]={component:a.$components[0].componentName}}),a.forEach(this.$scope.$connections,function(c,d){c=a.copy(c),delete c.$destroy,b.connections=b.connections||{},b.connections[d]=c}),b;if(!a.isObject(b))throw"$network: Invalid graph: "+b;if(this.empty(),a.isObject(b.processes)){var c;for(var d in b.processes)c=b.processes[d],this.process(d,c.component,c.portsAlias)}if(a.isObject(b.connections))for(var e in b.connections){var f=b.connections[e];a.isDefined(f.from)?this.connection(f.from,e):a.isDefined(f.data)&&this.data(f.data,e)}return this},b.prototype.fbp=function(a){return 0==arguments.length?"IMPLEMENT ME":"undefined"==typeof h?this:this.graph(h.parse(a))};var d={$get:["$rootScope","$component",function(a,c){return function(d,e){return new b(a,c,d,e)}}]};return d}),g.directive("floNetwork",["$network","$http","$sce",function(b,c,d){function e(a,b,c,d,e){return b.fbp(c),d&&b.import(a,d),e&&b.export(a,e),a.$emit("$floNetworkLoaded"),b}return{restrict:"EA",compile:function(f,g){var h=g.floNetwork||g.name||"",i=g["import"],j=g["export"],k=f.text();f.replaceWith(a.element("<!-- flo-network: \n"+k+"\n -->"));var l;return function(a,f,g){g.src?a.$watch(d.parseAsResourceUrl(g.src),function(d){c.get(d).success(function(c){l||(l=b(h)),e(a,l,c,i,j)}),a.$emit("$floNetworkRequested")}):k&&(l=b(h),e(a,l,k,i,j))}}}}]);var h;a.element(c).find("head").prepend('<style type="text/css">@charset "UTF-8";flo-network,[flo\\:network],[flo-network],[data-flo-network],[x-flo-network],.flo-network,.x-flo-network{display:none !important;}</style>'),h=function(){function a(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var b={parse:function(b,c){function e(a){D>B||(B>D&&(D=B,E=[]),E.push(a))}function f(){var a,b,c;for(c=B,a=[],b=g();null!==b;)a.push(b),b=g();return null!==a&&(a=function(){return y.getResult()}(c)),null===a&&(B=c),a}function g(){var a,c,d,f,g,k;return g=B,a=i(),null!==a?(/^[\n\r\u2028\u2029]/.test(b.charAt(B))?(c=b.charAt(B),B++):(c=null,0===C&&e("[\\n\\r\\u2028\\u2029]")),c=null!==c?c:"",null!==c?a=[a,c]:(a=null,B=g)):(a=null,B=g),null===a&&(g=B,a=t(),null!==a?(/^[\n\r\u2028\u2029]/.test(b.charAt(B))?(c=b.charAt(B),B++):(c=null,0===C&&e("[\\n\\r\\u2028\\u2029]")),null!==c?a=[a,c]:(a=null,B=g)):(a=null,B=g),null===a&&(g=B,k=B,a=t(),null!==a?(c=j(),null!==c?(d=t(),null!==d?(f=h(),f=null!==f?f:"",null!==f?a=[a,c,d,f]:(a=null,B=k)):(a=null,B=k)):(a=null,B=k)):(a=null,B=k),null!==a&&(a=function(a,b){return y.registerEdges(b)}(g,a[1])),null===a&&(B=g))),a}function h(){var a,c,d,f,g,h;return h=B,a=t(),null!==a?(44===b.charCodeAt(B)?(c=",",B++):(c=null,0===C&&e('","')),c=null!==c?c:"",null!==c?(d=i(),d=null!==d?d:"",null!==d?(/^[\n\r\u2028\u2029]/.test(b.charAt(B))?(f=b.charAt(B),B++):(f=null,0===C&&e("[\\n\\r\\u2028\\u2029]")),f=null!==f?f:"",null!==f?(g=t(),null!==g?a=[a,c,d,f,g]:(a=null,B=h)):(a=null,B=h)):(a=null,B=h)):(a=null,B=h)):(a=null,B=h),a}function i(){var a,c,d,f,g;if(g=B,a=t(),null!==a)if(35===b.charCodeAt(B)?(c="#",B++):(c=null,0===C&&e('"#"')),null!==c){for(d=[],f=s();null!==f;)d.push(f),f=s();null!==d?a=[a,c,d]:(a=null,B=g)}else a=null,B=g;else a=null,B=g;return a}function j(){var a,c,d,f,g,h,i;return h=B,i=B,a=k(),null!==a?(c=t(),null!==c?("->"===b.substr(B,2)?(d="->",B+=2):(d=null,0===C&&e('"->"')),null!==d?(f=t(),null!==f?(g=j(),null!==g?a=[a,c,d,f,g]:(a=null,B=i)):(a=null,B=i)):(a=null,B=i)):(a=null,B=i)):(a=null,B=i),null!==a&&(a=function(a,b,c){return[b,c]}(h,a[0],a[4])),null===a&&(B=h),null===a&&(a=k()),a}function k(){var a,b,c,d,e,f,g;return f=B,g=B,a=r(),null!==a?(b=t(),null!==b?(c=o(),null!==c?(d=t(),null!==d?(e=r(),null!==e?a=[a,b,c,d,e]:(a=null,B=g)):(a=null,B=g)):(a=null,B=g)):(a=null,B=g)):(a=null,B=g),null!==a&&(a=function(a,b,c,d){return[c+"."+b,{from:c+"."+d}]}(f,a[0],a[2],a[4])),null===a&&(B=f),null===a&&(a=n(),null===a&&(a=l(),null===a&&(a=m()))),a}function l(){var a,b,c,d,e;return d=B,e=B,a=o(),null!==a?(b=t(),null!==b?(c=r(),null!==c?a=[a,b,c]:(a=null,B=e)):(a=null,B=e)):(a=null,B=e),null!==a&&(a=function(a,b,c){return{from:b+"."+c}}(d,a[0],a[2])),null===a&&(B=d),a}function m(){var a,c,d,f,g;if(f=B,g=B,39===b.charCodeAt(B)?(a="'",B++):(a=null,0===C&&e('"\'"')),null!==a){for(c=[],d=s();null!==d;)c.push(d),d=s();null!==c?(39===b.charCodeAt(B)?(d="'",B++):(d=null,0===C&&e('"\'"')),null!==d?a=[a,c,d]:(a=null,B=g)):(a=null,B=g)}else a=null,B=g;return null!==a&&(a=function(a,b){return{data:b.join("")}}(f,a[1])),null===a&&(B=f),a}function n(){var a,b,c,d,e;return d=B,e=B,a=r(),null!==a?(b=t(),null!==b?(c=o(),null!==c?a=[a,b,c]:(a=null,B=e)):(a=null,B=e)):(a=null,B=e),null!==a&&(a=function(a,b,c){return c+"."+b}(d,a[0],a[2])),null===a&&(B=d),a}function o(){var a,c,d,f;if(d=B,f=B,/^[a-zA-Z0-9]/.test(b.charAt(B))?(c=b.charAt(B),B++):(c=null,0===C&&e("[a-zA-Z0-9]")),null!==c)for(a=[];null!==c;)a.push(c),/^[a-zA-Z0-9]/.test(b.charAt(B))?(c=b.charAt(B),B++):(c=null,0===C&&e("[a-zA-Z0-9]"));else a=null;return null!==a?(c=p(),c=null!==c?c:"",null!==c?a=[a,c]:(a=null,B=f)):(a=null,B=f),null!==a&&(a=function(a,b,c){return c&&y.addNode(b.join(""),c),b.join("")}(d,a[0],a[1])),null===a&&(B=d),a}function p(){var a,c,d,f,g,h;if(g=B,h=B,40===b.charCodeAt(B)?(a="(",B++):(a=null,0===C&&e('"("')),null!==a){if(/^[a-zA-Z\/\-]/.test(b.charAt(B))?(d=b.charAt(B),B++):(d=null,0===C&&e("[a-zA-Z\\/\\-]")),null!==d)for(c=[];null!==d;)c.push(d),/^[a-zA-Z\/\-]/.test(b.charAt(B))?(d=b.charAt(B),B++):(d=null,0===C&&e("[a-zA-Z\\/\\-]"));else c=null;c=null!==c?c:"",null!==c?(d=q(),d=null!==d?d:"",null!==d?(41===b.charCodeAt(B)?(f=")",B++):(f=null,0===C&&e('")"')),null!==f?a=[a,c,d,f]:(a=null,B=h)):(a=null,B=h)):(a=null,B=h)}else a=null,B=h;return null!==a&&(a=function(a,b,c){var d={};return d.comp=b?b.join(""):"",c?d.meta=c.join("").split(","):null,d}(g,a[1],a[2])),null===a&&(B=g),a}function q(){var a,c,d,f,g;if(f=B,g=B,58===b.charCodeAt(B)?(a=":",B++):(a=null,0===C&&e('":"')),null!==a){if(/^[a-zA-Z\/]/.test(b.charAt(B))?(d=b.charAt(B),B++):(d=null,0===C&&e("[a-zA-Z\\/]")),null!==d)for(c=[];null!==d;)c.push(d),/^[a-zA-Z\/]/.test(b.charAt(B))?(d=b.charAt(B),B++):(d=null,0===C&&e("[a-zA-Z\\/]"));else c=null;null!==c?a=[a,c]:(a=null,B=g)}else a=null,B=g;return null!==a&&(a=function(a,b){return b}(f,a[1])),null===a&&(B=f),a}function r(){var a,c,d,f,g;if(f=B,g=B,/^[A-Z]/.test(b.charAt(B))?(a=b.charAt(B),B++):(a=null,0===C&&e("[A-Z]")),null!==a){for(c=[],/^[A-Z0-9]/.test(b.charAt(B))?(d=b.charAt(B),B++):(d=null,0===C&&e("[A-Z0-9]"));null!==d;)c.push(d),/^[A-Z0-9]/.test(b.charAt(B))?(d=b.charAt(B),B++):(d=null,0===C&&e("[A-Z0-9]"));null!==c?(d=u(),null!==d?a=[a,c,d]:(a=null,B=g)):(a=null,B=g)}else a=null,B=g;return null!==a&&(a=function(a,b,c){return(b[0]+c.join("")).toLowerCase()}(f,a[0],a[1])),null===a&&(B=f),a}function s(){var a;return/^[a-zA-Z0-9 .,#:{}@+?!^=()_\-$*\/\\[\]{}"&`%|]/.test(b.charAt(B))?(a=b.charAt(B),B++):(a=null,0===C&&e('[a-zA-Z0-9 .,#:{}@+?!^=()_\\-$*\\/\\\\[\\]{}"&`%|]')),a}function t(){var a,c;for(a=[],/^[" "\t]/.test(b.charAt(B))?(c=b.charAt(B),B++):(c=null,0===C&&e('[" "\\t]'));null!==c;)a.push(c),/^[" "\t]/.test(b.charAt(B))?(c=b.charAt(B),B++):(c=null,0===C&&e('[" "\\t]'));return a=null!==a?a:""}function u(){var a,c;if(/^[" "\t]/.test(b.charAt(B))?(c=b.charAt(B),B++):(c=null,0===C&&e('[" "\\t]')),null!==c)for(a=[];null!==c;)a.push(c),/^[" "\t]/.test(b.charAt(B))?(c=b.charAt(B),B++):(c=null,0===C&&e('[" "\\t]'));else a=null;return a}function v(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}function w(){for(var a=1,c=1,d=!1,e=0;e<Math.max(B,D);e++){var f=b.charAt(e);"\n"===f?(d||a++,c=1,d=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a++,c=1,d=!0):(c++,d=!1)}return{line:a,column:c}}var x={start:f,line:g,LineTerminator:h,comment:i,connection:j,bridge:k,leftlet:l,iip:m,rightlet:n,node:o,component:p,compMeta:q,port:r,anychar:s,_:t,__:u};if(c!==d){if(x[c]===d)throw new Error("Invalid rule name: "+a(c)+".")}else c="start";var y,z,A,B=0,C=0,D=0,E=[];y=this,z=y.edges=[],A={},y.addNode=function(a,b){A[a]||(A[a]={}),b.comp&&(A[a].component=b.comp),b.meta&&(A[a].metadata={routes:b.meta})},y.getResult=function(){return{processes:A,connections:y.processEdges()}};var F=function(a,b){for(var c=-1,d=a?a.length:0,e=[];++c<d;){var f=a[c];f instanceof Array?Array.prototype.push.apply(e,b?f:F(f)):e.push(f)}return e};y.registerEdges=function(a){a.forEach(function(a){y.edges.push(a)})},y.processEdges=function(){var a,b;a=F(y.edges),b={};var c;return a.forEach(function(a,d){return 0!==d%2?(b[a]=c,void 0):(c=a,void 0)}),b};var G=x[c]();if(null===G||B!==b.length){var H=Math.max(B,D),I=H<b.length?b.charAt(H):null,J=w();throw new this.SyntaxError(v(E),I,H,J.line,J.column)}return G},toSource:function(){return this._source}};return b.SyntaxError=function(b,c,d,e,f){function g(b,c){var d,e;switch(b.length){case 0:d="end of input";break;case 1:d=b[0];break;default:d=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}return e=c?a(c):"end of input","Expected "+d+" but "+e+" found."}this.name="SyntaxError",this.expected=b,this.found=c,this.message=g(b,c),this.offset=d,this.line=e,this.column=f},b.SyntaxError.prototype=Error.prototype,b}()}(angular,window,document);